<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹ä¸­è‹±æ–‡é€šé—œå‚³èªªï¼šå…¨æ–‡æ³•æ”»ç•¥</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #4f46e5;
            --accent: #f59e0b;
            --bg: #f0fdf4; /* æ·¡æ·¡çš„ç¶ è‰²èƒŒæ™¯ï¼Œè­·çœ¼ä¸”æ”¾é¬† */
            --card-bg: #ffffff;
            --text: #1f2937;
            --correct: #10b981;
            --wrong: #ef4444;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- Header --- */
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            color: var(--secondary);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        .subtitle {
            color: #6b7280;
            font-size: 0.95rem;
        }

        /* --- Menu Grid System --- */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .topic-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .topic-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .topic-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--text);
        }
        .topic-desc {
            font-size: 0.9rem;
            color: #6b7280;
            line-height: 1.4;
        }
        .topic-tag {
            display: inline-block;
            margin-top: 10px;
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 12px;
            background: #e0e7ff;
            color: var(--secondary);
            font-weight: bold;
            width: fit-content;
        }

        /* --- Game Interface (Hidden by default) --- */
        #game-interface {
            display: none;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 650px;
            margin: 0 auto;
        }

        .game-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .concept-section {
            padding: 20px;
            background: #fdf2f8; /* æ·ºç²‰ç´…æç¤ºå€ */
            border-bottom: 2px solid #fce7f3;
        }
        .concept-title { font-weight: bold; color: #db2777; margin-bottom: 8px; }
        .concept-content { font-size: 0.95rem; line-height: 1.6; }

        .quiz-section {
            padding: 30px 25px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .question-box {
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e5e7eb;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.2s;
            color: var(--text);
        }
        .option-btn:hover:not(:disabled) {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .feedback-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        .feedback-correct { background: #d1fae5; color: #065f46; }
        .feedback-wrong { background: #fee2e2; color: #991b1b; }

        .next-btn {
            display: none;
            width: 100%;
            margin-top: 15px;
            padding: 15px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
        }

        /* --- Result View --- */
        #result-view {
            display: none;
            text-align: center;
            padding: 40px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .stars { font-size: 3rem; color: #d1d5db; margin: 20px 0; }
        .stars span.gold { color: var(--accent); text-shadow: 0 0 15px rgba(245, 158, 11, 0.6); }
        .score-big { font-size: 4rem; font-weight: 900; color: var(--secondary); }
        
        .highlight-keyword {
            color: #d946ef;
            font-weight: bold;
            background: #fae8ff;
            padding: 2px 6px;
            border-radius: 4px;
        }

    </style>
</head>
<body>

<div class="container">
    <header id="main-header">
        <h1>âš”ï¸ åœ‹ä¸­è‹±æ–‡é€šé—œå‚³èªª</h1>
        <div class="subtitle">é¸æ“‡ä¸€å€‹é—œå¡ï¼Œé–‹å§‹ä¿®è£œä½ çš„æ–‡æ³•åœ°åœ–ï¼</div>
    </header>

    <div id="menu-view" class="menu-grid">
        </div>

    <div id="game-interface">
        <div class="game-header">
            <button class="back-btn" onclick="showMenu()">â® å›ç›®éŒ„</button>
            <span id="level-title-display">Level Title</span>
            <span>â˜… <span id="current-score">0</span></span>
        </div>
        
        <div class="concept-section" id="concept-display">
            </div>

        <div class="quiz-section">
            <div class="progress-info">
                <span>æŒ‘æˆ°é€²åº¦</span>
                <span id="progress-text">1 / 5</span>
            </div>
            
            <div class="question-box" id="question-text">
                Loading...
            </div>

            <div class="options-grid" id="options-area">
                </div>

            <div class="feedback-box" id="feedback-area"></div>
            <button class="next-btn" id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â”</button>
        </div>
    </div>

    <div id="result-view">
        <h2>ğŸ‰ é—œå¡å®Œæˆï¼</h2>
        <div class="stars" id="result-stars">
            <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        </div>
        <div>æœ¬æ¬¡å¾—åˆ†</div>
        <div class="score-big" id="final-score">0</div>
        <p id="result-comment" style="color:#666; margin-bottom: 30px;">è©•èª...</p>
        <button class="option-btn" style="background:var(--secondary); color:white; border:none;" onclick="showMenu()">å›åˆ°åœ°åœ–</button>
    </div>
</div>

<script>
    // --- Data: åœ‹ä¸­æ ¸å¿ƒæ–‡æ³•è³‡æ–™åº« ---
    // é€™è£¡è¨­è¨ˆäº†ä¸åŒçš„äººç¨±è®ŠåŒ–èˆ‡é™·é˜±é¡Œ
    const grammarData = [
        {
            id: "u1_be",
            title: "ç¬¬ä¸€ç« ï¼šBe å‹•è©ç‹è€…",
            desc: "ææ‡‚ am, is, are çš„è®ŠåŒ–ï¼Œé€™æ˜¯æ‰€æœ‰è‹±æ–‡çš„åŸºç¤ï¼",
            tag: "åœ‹ä¸€ä¸Šæ ¸å¿ƒ",
            concept: `
                <div class="concept-title">ğŸ’¡ æ”»ç•¥å£è¨£ï¼š</div>
                <div class="concept-content">
                    1. <strong>I (æˆ‘)</strong> å°ˆç”¨ <span class="highlight-keyword">am</span>ã€‚<br>
                    2. <strong>You (ä½ ), We (æˆ‘å€‘), They (ä»–å€‘)</strong> ç”¨ <span class="highlight-keyword">are</span>ã€‚<br>
                    3. <strong>He/She/It (å–®æ•¸)</strong> ç”¨ <span class="highlight-keyword">is</span>ã€‚<br>
                    âš ï¸ é™·é˜±ï¼šåªè¦æ˜¯ã€Œè¤‡æ•¸ã€ï¼ˆå¦‚ï¼šTom and I, The catsï¼‰ï¼Œé€šé€šéƒ½ç”¨ <strong>are</strong>ï¼
                </div>
            `,
            questions: [
                { q: "I ___ very hungry.", options: ["am", "is", "are"], ans: 0, explain: "ä¸»è©æ˜¯ I (æˆ‘)ï¼Œåœ‹ç‹æ˜¯ amã€‚" },
                { q: "He ___ my brother.", options: ["am", "is", "are"], ans: 1, explain: "ä¸»è©æ˜¯ He (ä»–)ï¼Œå–®æ•¸ç”¨ isã€‚" },
                { q: "They ___ busy now.", options: ["is", "am", "are"], ans: 2, explain: "They (ä»–å€‘) æ˜¯è¤‡æ•¸ï¼Œè¦ç”¨ areã€‚" },
                { q: "My mother ___ a teacher.", options: ["is", "are", "am"], ans: 0, explain: "My mother = She (å¥¹)ï¼Œæ‰€ä»¥ç”¨ isã€‚" },
                { q: "Tom and I ___ good friends.", options: ["am", "are", "is"], ans: 1, explain: "æ³¨æ„ï¼Tom and I = We (æˆ‘å€‘)ï¼Œå…©å€‹äººæ˜¯è¤‡æ•¸ï¼Œè¦ç”¨ areï¼ä¸èƒ½çœ‹åˆ° I å°±é¸ amã€‚" },
                { q: "The dog ___ cute.", options: ["are", "is", "am"], ans: 1, explain: "The dog = It (ç‰ )ï¼Œå–®æ•¸ç”¨ isã€‚" },
                { q: "The books ___ on the desk.", options: ["is", "are", "am"], ans: 1, explain: "The books (æ›¸æœ¬å€‘) æœ‰åŠ  s æ˜¯è¤‡æ•¸ï¼Œè¦ç”¨ areã€‚" },
                { q: "Where ___ you from?", options: ["is", "are", "am"], ans: 1, explain: "ä¸»è©æ˜¯ you (ä½ )ï¼Œæ­é… areã€‚" }
            ]
        },
        {
            id: "u2_do",
            title: "ç¬¬äºŒç« ï¼šä¸€èˆ¬å‹•è© (åŠ©å‹•è©)",
            desc: "Do é‚„æ˜¯ Doesï¼Ÿåˆ†è¾¨å–®æ•¸èˆ‡è¤‡æ•¸çš„å‹•ä½œè¦å‰‡ã€‚",
            tag: "åœ‹ä¸€ä¸Šé€²éš",
            concept: `
                <div class="concept-title">ğŸ’¡ æ”»ç•¥å£è¨£ï¼š</div>
                <div class="concept-content">
                    1. ä¸€èˆ¬å‹•è©ç–‘å•å¥ï¼Œéœ€è¦è¶…äºº <strong>Do/Does</strong> ä¾†å¹«å¿™ã€‚<br>
                    2. <strong>He/She/It (å–®äºº)</strong> ç”¨ <span class="highlight-keyword">Does</span>ã€‚<br>
                    3. <strong>I/You/We/They (å¤šäºº)</strong> ç”¨ <span class="highlight-keyword">Do</span>ã€‚<br>
                    4. ç…§å¦–é¡æ³•å‰‡ï¼šåŠ©å‹•è© Do/Does å‡ºç¾å¾Œï¼Œå¾Œé¢çš„å‹•è©è¦æ‰“å›åŸå½¢ï¼
                </div>
            `,
            questions: [
                { q: "___ you like pizza?", options: ["Do", "Does", "Are"], ans: 0, explain: "ä¸»è©æ˜¯ Youï¼ŒåŠ©å‹•è©ç”¨ Doã€‚" },
                { q: "___ she play tennis?", options: ["Do", "Does", "Is"], ans: 1, explain: "ä¸»è©æ˜¯ She (ä¸‰å–®)ï¼ŒåŠ©å‹•è©ç”¨ Doesã€‚" },
                { q: "Does he ___ to school?", options: ["go", "goes", "going"], ans: 0, explain: "Does å‡ºç¾äº†ï¼å¾Œé¢çš„å‹•è©è¦è®Šå›åŸå½¢ goã€‚" },
                { q: "What ___ your father do?", options: ["do", "does", "is"], ans: 1, explain: "your father = He (ä»–)ï¼Œæ‰€ä»¥ç”¨ doesã€‚" },
                { q: "They ___ not watch TV.", options: ["do", "does", "are"], ans: 0, explain: "They (ä»–å€‘) å¦å®šç”¨ do not (don't)ã€‚" },
                { q: "___ Ken and Mary know you?", options: ["Do", "Does", "Are"], ans: 0, explain: "Ken and Mary = They (è¤‡æ•¸)ï¼Œæ‰€ä»¥ç”¨ Doã€‚" }
            ]
        },
        {
            id: "u3_ing",
            title: "ç¬¬ä¸‰ç« ï¼šç¾åœ¨é€²è¡Œå¼",
            desc: "æ­£åœ¨åšä»€éº¼ï¼Ÿè¨˜å¾— Be å‹•è© + V-ing å…¬å¼ã€‚",
            tag: "åœ‹ä¸€æ ¸å¿ƒ",
            concept: `
                <div class="concept-title">ğŸ’¡ æ”»ç•¥å£è¨£ï¼š</div>
                <div class="concept-content">
                    <strong>æ­£åœ¨åš</strong> = <span class="highlight-keyword">Beå‹•è© + V-ing</span>ã€‚<br>
                    ç¼ºä¸€ä¸å¯ï¼å°±åƒæ¼¢å ¡è¦æœ‰éºµåŒ…(Be)å’Œè‚‰(ing)æ‰å®Œæ•´ã€‚<br>
                    Look! Listen! Now! é€™äº›å­—å‡ºç¾é€šå¸¸éƒ½æ˜¯é€²è¡Œå¼ã€‚
                </div>
            `,
            questions: [
                { q: "I am ___ English.", options: ["study", "studying", "studies"], ans: 1, explain: "æœ‰ am (Beå‹•è©)ï¼Œå¾Œé¢å‹•ä½œè¦åŠ  ingã€‚" },
                { q: "Look! The bus is ___.", options: ["come", "coming", "comes"], ans: 1, explain: "Look (çœ‹!) æš—ç¤ºæ­£åœ¨ç™¼ç”Ÿï¼Œç”¨ is comingã€‚" },
                { q: "They ___ playing basketball.", options: ["is", "are", "do"], ans: 1, explain: "playing æœ‰ ingï¼Œå‰é¢è¦è£œä¸Š Beå‹•è©ï¼ŒThey é… areã€‚" },
                { q: "What are you ___?", options: ["doing", "do", "does"], ans: 0, explain: "å‰é¢æœ‰ areï¼Œå¾Œé¢ç”¨ doingã€‚" },
                { q: "___ she sleeping?", options: ["Does", "Is", "Do"], ans: 1, explain: "sleeping æœ‰ ingï¼Œå•å¥é–‹é ­è¦ç”¨ Isã€‚" }
            ]
        },
        {
            id: "u4_past",
            title: "ç¬¬å››ç« ï¼šéå»å¼ (was/were)",
            desc: "å›åˆ°éå»ï¼Be å‹•è©è®Šèº« was èˆ‡ wereã€‚",
            tag: "åœ‹äºŒåŸºç¤",
            concept: `
                <div class="concept-title">ğŸ’¡ æ”»ç•¥å£è¨£ï¼š</div>
                <div class="concept-content">
                    æ™‚å…‰æ©Ÿæ³•å‰‡ï¼š<br>
                    am / is â” è®Šæˆ <span class="highlight-keyword">was</span> (å–®æ•¸)<br>
                    are â” è®Šæˆ <span class="highlight-keyword">were</span> (è¤‡æ•¸)<br>
                    é—œéµå­—ï¼šYesterday (æ˜¨å¤©), Last night (æ˜¨æ™š), Ago (ä¹‹å‰)ã€‚
                </div>
            `,
            questions: [
                { q: "I ___ sick yesterday.", options: ["am", "was", "were"], ans: 1, explain: "yesterday æ˜¯éå»ï¼Œam è®Šæˆ wasã€‚" },
                { q: "They ___ at home last night.", options: ["are", "was", "were"], ans: 2, explain: "last night æ˜¯éå»ï¼Œare è®Šæˆ wereã€‚" },
                { q: "Where ___ you two hours ago?", options: ["was", "were", "are"], ans: 1, explain: "ago æ˜¯éå»ï¼Œyou æ­é… wereã€‚" },
                { q: "It ___ rainy last Sunday.", options: ["is", "was", "were"], ans: 1, explain: "It å–®æ•¸ï¼Œéå»å¼ç”¨ wasã€‚" },
                { q: "___ Ken happy yesterday?", options: ["Was", "Were", "Did"], ans: 0, explain: "Ken å–®æ•¸ï¼Œå•å¥ç”¨ Was é–‹é ­ã€‚" }
            ]
        },
        {
            id: "u5_past_did",
            title: "ç¬¬äº”ç« ï¼šéå»å¼ (Did)",
            desc: "ä¸€èˆ¬å‹•ä½œçš„éå»å¼ï¼Œè¦å‰‡è®ŠåŒ–èˆ‡ä¸è¦å‰‡è®ŠåŒ–ã€‚",
            tag: "åœ‹äºŒé‡é»",
            concept: `
                <div class="concept-title">ğŸ’¡ æ”»ç•¥å£è¨£ï¼š</div>
                <div class="concept-content">
                    1. è‚¯å®šå¥ï¼šå‹•è©åŠ  ed (å¦‚ played) æˆ–è®Šå½¢ (å¦‚ went)ã€‚<br>
                    2. ç–‘å•/å¦å®šå¥ï¼šå¬å–šè¶…äºº <span class="highlight-keyword">Did</span>ã€‚<br>
                    3. ç…§å¦–é¡ï¼šDid å‡ºç¾ï¼Œå¾Œé¢çš„å‹•è©è®Šå›åŸå½¢ï¼
                </div>
            `,
            questions: [
                { q: "He ___ basketball yesterday.", options: ["play", "played", "playing"], ans: 1, explain: "éå»å¼è‚¯å®šå¥ï¼Œplay åŠ  edã€‚" },
                { q: "I ___ to the zoo last week.", options: ["go", "went", "goes"], ans: 1, explain: "go çš„éå»å¼æ˜¯ä¸è¦å‰‡è®ŠåŒ– wentã€‚" },
                { q: "___ you see him yesterday?", options: ["Do", "Did", "Were"], ans: 1, explain: "see æ˜¯å‹•ä½œï¼Œéå»ç–‘å•å¥ç”¨ Didã€‚" },
                { q: "She didn't ___ homework.", options: ["did", "do", "does"], ans: 1, explain: "didn't å‡ºç¾ï¼Œå¾Œé¢å‹•è©ç”¨åŸå½¢ doã€‚" },
                { q: "They ___ pizza last night.", options: ["eat", "ate", "eating"], ans: 1, explain: "eat çš„éå»å¼æ˜¯ ateã€‚" }
            ]
        },
        {
            id: "u6_future",
            title: "ç¬¬å…­ç« ï¼šæœªä¾†å¼",
            desc: "å°‡è¦åšä»€éº¼ï¼ŸWill èˆ‡ Be going to çš„ç”¨æ³•ã€‚",
            tag: "åœ‹äºŒæ ¸å¿ƒ",
            concept: `
                <div class="concept-title">ğŸ’¡ æ”»ç•¥å£è¨£ï¼š</div>
                <div class="concept-content">
                    1. <span class="highlight-keyword">will</span> + åŸå½¢å‹•è©ã€‚<br>
                    2. <span class="highlight-keyword">be going to</span> + åŸå½¢å‹•è©ã€‚<br>
                    é—œéµå­—ï¼šTomorrow (æ˜å¤©), Next week (ä¸‹é€±)ã€‚
                </div>
            `,
            questions: [
                { q: "I ___ call you tomorrow.", options: ["will", "am", "did"], ans: 0, explain: "tomorrow æ˜¯æœªä¾†ï¼Œç”¨ willã€‚" },
                { q: "He is ___ to buy a car.", options: ["go", "going", "will"], ans: 1, explain: "is going to æ˜¯æœªä¾†å¼ç‰‡èªã€‚" },
                { q: "They will ___ to Taipei.", options: ["go", "going", "went"], ans: 0, explain: "will å¾Œé¢ä¸€å®šè¦æ¥åŸå½¢å‹•è© goã€‚" },
                { q: "Are you going to ___ basketball?", options: ["playing", "play", "played"], ans: 1, explain: "to å¾Œé¢æ¥åŸå½¢å‹•è© playã€‚" }
            ]
        },
        {
            id: "u7_ordinal",
            title: "ç¬¬ä¸ƒç« ï¼šå½¢å®¹è©æ¯”è¼ƒç´š",
            desc: "æ¯”è¼ƒèª°æ¯”è¼ƒå¿«ã€èª°æ¯”è¼ƒé«˜ï¼Ÿer èˆ‡ moreã€‚",
            tag: "åœ‹äºŒé€²éš",
            concept: `
                <div class="concept-title">ğŸ’¡ æ”»ç•¥å£è¨£ï¼š</div>
                <div class="concept-content">
                    1. çŸ­çš„å­—ï¼šå­—å°¾ + <span class="highlight-keyword">er</span> (ä¾‹ï¼štaller)ã€‚<br>
                    2. é•·çš„å­—ï¼šå‰é¢ + <span class="highlight-keyword">more</span> (ä¾‹ï¼šmore beautiful)ã€‚<br>
                    3. é—œéµå­—ï¼š<strong>than</strong> (æ¯”)ã€‚
                </div>
            `,
            questions: [
                { q: "The elephant is ___ than the dog.", options: ["big", "biger", "bigger"], ans: 2, explain: "big é‡è¤‡å­—å°¾åŠ  er è®Šæˆ biggerã€‚" },
                { q: "She is ___ than me.", options: ["taller", "tall", "more tall"], ans: 0, explain: "tall æ˜¯çŸ­å­—ï¼Œç›´æ¥åŠ  erã€‚" },
                { q: "English is ___ than math.", options: ["easyer", "easier", "more easy"], ans: 1, explain: "easy å» y æ”¹ ierã€‚" },
                { q: "This flower is ___ than that one.", options: ["beautiful", "beautifuler", "more beautiful"], ans: 2, explain: "beautiful æ˜¯é•·å­—ï¼Œå‰é¢åŠ  moreã€‚" }
            ]
        }
    ];

    // --- State Management ---
    let currentTopic = null;
    let currentQuestionIndex = 0;
    let score = 0;

    // --- DOM Elements ---
    const menuView = document.getElementById('menu-view');
    const gameInterface = document.getElementById('game-interface');
    const mainHeader = document.getElementById('main-header');
    const resultView = document.getElementById('result-view');
    
    // Game elements
    const conceptDisplay = document.getElementById('concept-display');
    const questionText = document.getElementById('question-text');
    const optionsArea = document.getElementById('options-area');
    const feedbackArea = document.getElementById('feedback-area');
    const nextBtn = document.getElementById('next-btn');
    const scoreDisplay = document.getElementById('current-score');
    const progressText = document.getElementById('progress-text');
    const levelTitleDisplay = document.getElementById('level-title-display');

    // --- Initialization ---
    function init() {
        renderMenu();
    }

    function renderMenu() {
        menuView.innerHTML = '';
        grammarData.forEach((topic, index) => {
            const card = document.createElement('div');
            card.className = 'topic-card';
            card.onclick = () => startGame(index);
            
            // Assign random icon for fun
            const icons = ['ğŸ°', 'âš”ï¸', 'ğŸ›¡ï¸', 'ğŸ§™â€â™‚ï¸', 'ğŸ‰', 'ğŸ“œ', 'ğŸ¯'];
            const icon = icons[index % icons.length];

            card.innerHTML = `
                <div>
                    <div class="topic-icon">${icon}</div>
                    <div class="topic-title">${topic.title}</div>
                    <div class="topic-desc">${topic.desc}</div>
                </div>
                <div class="topic-tag">${topic.tag}</div>
            `;
            menuView.appendChild(card);
        });
    }

    // --- Game Logic ---
    function startGame(index) {
        currentTopic = grammarData[index];
        currentQuestionIndex = 0;
        score = 0;
        
        // Hide menu, show game
        menuView.style.display = 'none';
        mainHeader.style.display = 'none';
        resultView.style.display = 'none';
        gameInterface.style.display = 'block';

        // Setup UI
        levelTitleDisplay.textContent = currentTopic.title;
        conceptDisplay.innerHTML = currentTopic.concept;
        scoreDisplay.textContent = 0;

        loadQuestion();
    }

    function showMenu() {
        gameInterface.style.display = 'none';
        resultView.style.display = 'none';
        mainHeader.style.display = 'block';
        menuView.style.display = 'grid';
    }

    function loadQuestion() {
        const qData = currentTopic.questions[currentQuestionIndex];
        
        progressText.textContent = `${currentQuestionIndex + 1} / ${currentTopic.questions.length}`;
        questionText.textContent = qData.q;
        
        // Reset Inputs
        feedbackArea.style.display = 'none';
        feedbackArea.className = 'feedback-box';
        nextBtn.style.display = 'none';
        optionsArea.innerHTML = '';

        // Generate Options
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(idx);
            optionsArea.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex) {
        const qData = currentTopic.questions[currentQuestionIndex];
        const buttons = optionsArea.querySelectorAll('button');
        
        // Lock buttons
        buttons.forEach(btn => btn.disabled = true);

        if(selectedIndex === qData.ans) {
            // Correct
            score++;
            scoreDisplay.textContent = score;
            buttons[selectedIndex].style.background = '#d1fae5';
            buttons[selectedIndex].style.borderColor = '#10b981';
            feedbackArea.textContent = "ğŸ‰ æ­£ç¢ºï¼ " + qData.explain;
            feedbackArea.classList.add('feedback-correct');
        } else {
            // Wrong
            buttons[selectedIndex].style.background = '#fee2e2';
            buttons[selectedIndex].style.borderColor = '#ef4444';
            // Show correct one
            buttons[qData.ans].style.background = '#d1fae5';
            
            feedbackArea.textContent = "ğŸ’ª åŠ æ²¹ï¼ " + qData.explain;
            feedbackArea.classList.add('feedback-wrong');
        }

        feedbackArea.style.display = 'block';
        nextBtn.style.display = 'block';
    }

    function nextQuestion() {
        if (currentQuestionIndex < currentTopic.questions.length - 1) {
            currentQuestionIndex++;
            loadQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        gameInterface.style.display = 'none';
        resultView.style.display = 'block';

        const total = currentTopic.questions.length;
        const finalScoreVal = Math.round((score / total) * 100);
        document.getElementById('final-score').textContent = finalScoreVal;

        // Star logic
        let starsHTML = '';
        let comment = '';
        if (score === total) {
            starsHTML = '<span class="gold">â˜…</span><span class="gold">â˜…</span><span class="gold">â˜…</span>';
            comment = "å®Œç¾é€šé—œï¼ä½ æ˜¯æ–‡æ³•å¤§å¸«ï¼ğŸ†";
        } else if (score >= total - 2) {
            starsHTML = '<span class="gold">â˜…</span><span class="gold">â˜…</span><span>â˜…</span>';
            comment = "å¤ªæ£’äº†ï¼è§€å¿µå·²ç¶“å¾ˆæ¸…æ¥šå›‰ï¼ğŸ‘";
        } else {
            starsHTML = '<span class="gold">â˜…</span><span>â˜…</span><span>â˜…</span>';
            comment = "æ²’é—œä¿‚ï¼Œå¤šç©å¹¾æ¬¡å°±æœƒäº†ï¼åªè¦å¼„æ‡‚å°±æ˜¯é€²æ­¥ï¼ğŸ’ª";
        }

        document.getElementById('result-stars').innerHTML = starsHTML;
        document.getElementById('result-comment').textContent = comment;
    }

    // Run
    init();

</script>

</body>
</html>